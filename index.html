<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åŠ æ³•è¡¨ & åŠ æ¸›æ³•ç·´ç¿’</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Tone.js -->
  <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>

  <!-- è‡ªè¨‚æ¨£å¼ï¼ˆæ”¾åœ¨ Tailwind å¾Œé¢ï¼‰ -->
  <style>
/* çµ±ä¸€æŠŠç·´ç¿’é¡Œçš„å­—è®Šå°ä¸€è™Ÿï¼ˆç›´å¼èˆ‡æ©«å¼éƒ½è“‹ï¼‰ */
#question-box > p,
#question-box > div{
  font-size: clamp(28px, 6vw, 44px) !important; /* ä½ ä¹Ÿå¯ä»¥æ”¹æˆ 26px / 5.5vw / 40px ç­‰ */
}

/* æ‰‹æ©Ÿå†å°ä¸€é»ï¼ˆå¯é¸ï¼‰ */
@media (max-width: 480px){
  #question-box > p,
  #question-box > div{
    font-size: 32px !important;
  }
}
</style>

  <style>
    /* ===== å°è¦½åˆ—ï¼ˆå…©é¡†æŒ‰éˆ•ï¼‰â€”å¤–è§€èˆ‡ä¸å¤–å‡¸ ===== */
    nav.nav-bar{
      width: 100%;
      max-width: 720px;               /* æ¡Œæ©Ÿæ”¶æ–‚å¯¬åº¦ */
      margin: 0 auto 16px;            /* ç½®ä¸­ */
      padding: 12px 16px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.08);
      box-sizing: border-box;
    }
    /* pill æŒ‰éˆ•å…±åŒæ¨£å¼ï¼ˆæé‚Š + å¾®é™°å½±ï¼‰ */
    #btn-learning, #btn-practice{
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 9999px;
      box-shadow: 0 4px 12px rgba(0,0,0,.06), inset 0 -2px 0 rgba(0,0,0,.03);
      font-weight: 900;
      letter-spacing: .2px;
      transition: transform .14s ease, box-shadow .14s ease, background-color .14s ease, color .14s ease;
    }
    #btn-learning:hover, #btn-practice:hover{ transform: translateY(-1px) }
    #btn-learning:active, #btn-practice:active{ transform: translateY(0) scale(.98) }

    /* æ‰‹æ©Ÿï¼šå…©é¡†å›ºå®šåŒä¸€è¡Œã€ä¸æ²å‹•ï¼›é¿å…æ”¾å¤§é€ æˆå¤–æº¢ */
    @media (max-width: 480px){
      nav.nav-bar{
        padding: 10px 12px;
        overflow: hidden;                       /* å¤¾ä½å…§éƒ¨æº¢å‡º */
      }
      .nav-inner{
        display: grid !important;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
      }
      #btn-learning, #btn-practice{
        width: 100%;
        font-size: 16px !important;
        line-height: 1.2;
        padding: 10px 12px !important;
        transform: none !important;             /* è¦†è“‹ hover:scale-105 */
      }
      html, body{ overflow-x: hidden; }         /* ä¿éšªï¼šç¦æ°´å¹³æ²å‹• */
    }

    /* ====== åŠ æ³•è¡¨ï¼ˆé‚Šç•Œèˆ‡å­—ç´šï¼‰ ====== */
    #addition-table{
      width: 100%;
      border-collapse: collapse !important;
      border: 1px solid #bfdbfe !important;     /* blue-200 */
      border-radius: 6px !important;
      background: #eff6ff;                      /* blue-50 */
      box-shadow: 0 8px 20px rgba(30,64,175,.06);
      table-layout: fixed;
      font-size: clamp(14px, 3.4vw, 18px);      /* æ‰‹æ©Ÿç•¥å°ã€æ¡Œæ©Ÿæ­£å¸¸ */
    }
    #addition-table th, #addition-table td{
      padding: 8px 8px;
      border-bottom: 1px solid #bfdbfe;
      text-align: center; white-space: nowrap;
    }
    #addition-table thead th{ background:#dbeafe; color:#1e40af; font-weight:800 } /* blue-100/800 */
    /* ç¬¬ä¸€æ¬„å›ºå®š */
    #addition-table td:first-child{
      position: sticky; left: 0;
      background: #eaf2ff; color:#1d4ed8; font-weight:800;
    }
    /* æ‰‹æ©Ÿï¼šè¡¨æ ¼æ›´è²¼é‚Šã€å­—æ›´å°ã€æ ¼æ›´ç·Šæ¹Š */
    @media (max-width: 480px){
      #page-learning .overflow-x-auto{
        margin-left: -10px; margin-right: -10px; padding: 0 4px;
      }
      #addition-table{ font-size: 14px !important; }
      #addition-table th, #addition-table td{ padding: 6px 6px; }
    }

    /* ====== é‡é»ï¼šè®“æ»‘éæ™‚çš„ highlight å»¶ä¼¸åˆ°è¡¨é ­èˆ‡æœ€å·¦æ¬„ ======
       æˆ‘å€‘ç”¨å’Œ JS ç›¸åŒçš„ class åç¨±ï¼ˆbg-yellow-100 / 300ï¼‰ï¼Œ
       ä½†ç”¨è‡ªå·±çš„ CSS ç›´æ¥æŒ‡å®šé¡è‰²ï¼Œç¢ºä¿å³ä½¿ Tailwind æ²’æƒåˆ°ä¹Ÿèƒ½ç”Ÿæ•ˆã€‚ */
    #addition-table th.bg-yellow-300,
    #addition-table td.bg-yellow-300 {
      background-color: #fcd34d !important; /* yellow-300 */
      color: #111827 !important;
    }
    #addition-table th.bg-yellow-100,
    #addition-table td.bg-yellow-100 {
      background-color: #fef3c7 !important; /* yellow-100 */
      color: #111827 !important;
    }

    /* ===== ç‰ˆæ¬Š ===== */
    .site-footer{
      width: 100%;
      max-width: 720px;
      box-sizing: border-box;
      margin: 20px auto 0;
      padding: 14px 12px;
      text-align: center;
      color: #6b7280;               /* slate-500 */
      font-size: 13.5px;
      border-top: 1px solid #e5e7eb;
      background: transparent;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-pink-100 to-blue-100 flex flex-col items-center justify-start p-4">
  <!-- NAV -->
  <nav class="nav-bar">
    <div class="nav-inner flex flex-nowrap justify-center items-center gap-3 sm:gap-4">
      <button id="btn-learning"
        class="px-4 py-2 sm:px-6 sm:py-3 rounded-full text-base sm:text-lg font-bold bg-purple-500 text-white shadow-md">
        â• å­¸ç¿’åŠ æ³•
      </button>
      <button id="btn-practice"
        class="px-4 py-2 sm:px-6 sm:py-3 rounded-full text-base sm:text-lg font-bold bg-green-200 text-green-800 hover:bg-green-300">
        ğŸ“ ç·´ç¿’æŒ‘æˆ°
      </button>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="w-full max-w-4xl p-2 md:p-4">
    <!-- Learning Page -->
    <section id="page-learning" class="text-center">
      <h1 class="text-4xl md:text-5xl font-extrabold text-blue-600 mb-6 drop-shadow-md">åŠ æ³•è¡¨ ğŸ’–</h1>
      <div class="overflow-x-auto">
        <table id="addition-table" class="text-sm sm:text-base md:text-lg"></table>
      </div>
  
    </section>

    <!-- Practice Page -->
    <section id="page-practice" class="text-center hidden">
      <div id="practice-select" class="text-center p-4">
        <h1 class="text-4xl md:text-5xl font-extrabold text-green-600 mb-6 drop-shadow-md">åŠ æ¸›æ³•å¤§æŒ‘æˆ° ğŸŒŸ</h1>

        <div class="flex flex-col gap-3 max-w-3xl mx-auto mb-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full">
            <button data-mode="addition18"
              class="mode-btn p-3 rounded-xl text-2xl font-bold transition-all duration-300 transform hover:scale-110 shadow-md bg-indigo-200 text-indigo-800 hover:bg-indigo-300">
              â• 18ä»¥å…§åŠ æ³•
            </button>
            <button data-mode="subtraction18"
              class="mode-btn p-3 rounded-xl text-2xl font-bold transition-all duration-300 transform hover:scale-110 shadow-md bg-rose-200 text-rose-800 hover:bg-rose-300">
              â– 18ä»¥å…§æ¸›æ³•
            </button>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full">
            <button data-mode="twoDigitAddition"
              class="mode-btn p-3 rounded-xl text-2xl font-bold transition-all duration-300 transform hover:scale-110 shadow-md bg-amber-200 text-amber-800 hover:bg-amber-300">
              ğŸ”¢ äºŒä½æ•¸åŠ æ³•
            </button>
            <button data-mode="twoDigitSubtraction"
              class="mode-btn p-3 rounded-xl text-2xl font-bold transition-all duration-300 transform hover:scale-110 shadow-md bg-cyan-200 text-cyan-800 hover:bg-cyan-300">
              ğŸ“Š äºŒä½æ•¸æ¸›æ³•
            </button>
          </div>

          <div class="flex justify-center w-full">
            <button data-mode="mixed"
              class="mode-btn p-3 rounded-xl text-2xl font-bold transition-all duration-300 transform hover:scale-110 shadow-md w-full sm:w-1/2 md:w-1/3 lg:w-1/4 bg-teal-200 text-teal-800 hover:bg-teal-300"
              style="max-width:300px">
              ğŸ”€ ç¶œåˆç·´ç¿’
            </button>
          </div>
        </div>

        <button id="btn-start"
          class="px-8 py-4 rounded-full text-2xl font-bold transition-all duration-300 transform hover:scale-105 shadow-lg bg-gray-300 text-gray-600 cursor-not-allowed"
          disabled>
          é–‹å§‹ç·´ç¿’ï¼ğŸš€
        </button>
      </div>

      <div id="practice-play" class="hidden text-center p-4">
        <h1 id="practice-title" class="text-4xl md:text-5xl font-extrabold text-purple-600 mb-4 drop-shadow-md">åŠ æ¸›æ³•ç·´ç¿’ âœ¨</h1>
        <div class="text-2xl md:text-3xl font-bold text-gray-700 mb-2">
          å¾—åˆ†: <span id="score" class="text-green-600">0</span> / 100
        </div>
        <div class="text-xl md:text-2xl text-gray-600 mb-6">é¡Œç›® <span id="q-index">1</span> / 10</div>

        <div id="question-box" class="bg-yellow-100 p-6 rounded-3xl shadow-xl inline-block mb-6 transition-transform duration-300 transform scale-105"></div>

        <div id="options" class="grid grid-cols-2 gap-4 max-w-md mx-auto mb-4"></div>

        <p id="feedback" class="text-2xl md:text-3xl font-bold mt-4"></p>
      </div>

      <div id="practice-result" class="hidden text-center p-4">
        <h1 class="text-4xl md:text-5xl font-extrabold text-teal-600 mb-6 drop-shadow-md">ç·´ç¿’çµæŸï¼ğŸ‰</h1>
        <p class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">ä½ çš„æœ€çµ‚å¾—åˆ†æ˜¯ï¼š</p>
        <p id="final-score" class="text-5xl md:text-6xl font-extrabold text-teal-600 bg-teal-50 p-6 rounded-full inline-block shadow-lg animate-bounce mb-6">0 åˆ†</p>

        <h2 class="text-3xl font-bold text-blue-600 mt-6 mb-4 drop-shadow-md">é¡Œç›®å›é¡§</h2>
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 overflow-x-auto mx-auto max-w-xl">
          <table class="min-w-full text-left text-lg">
            <thead>
              <tr class="bg-blue-100 text-blue-800">
                <th class="py-2 px-3 border-b border-blue-200">é¡Œç›®</th>
                <th class="py-2 px-3 border-b border-blue-200">ä½ çš„ç­”æ¡ˆ</th>
                <th class="py-2 px-3 border-b border-blue-200">æ­£ç¢ºç­”æ¡ˆ</th>
              </tr>
            </thead>
            <tbody id="review-body"></tbody>
          </table>
        </div>

        <div class="mt-6 flex flex-col md:flex-row justify-center gap-4">
          <button id="btn-reselect"
            class="px-8 py-4 rounded-full text-2xl font-bold bg-orange-500 text-white hover:bg-orange-600 transition-all duration-300 transform hover:scale-105 shadow-lg">
            é‡æ–°é¸æ“‡ç·´ç¿’ ğŸ”„
          </button>
          <button id="btn-retry"
            class="px-8 py-4 rounded-full text-2xl font-bold bg-purple-500 text-white hover:bg-purple-600 transition-all duration-300 transform hover:scale-105 shadow-lg">
            å†ç©ä¸€æ¬¡ï¼âœ¨
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- ç‰ˆæ¬Š -->
  <footer class="site-footer">Â© 2025 Christina Yu. All rights reserved.</footer>

  <!-- è¡Œç‚ºè…³æœ¬ -->
  <script>
    // ---------- Global state ----------
    let currentPage = 'learning';
    let selectedMode = null;
    let score = 0;
    let qIndex = 0;
    let currentQuestion = null;
    let options = [];
    let questionHistory = [];
    let selectedAnswer = null;
    let isCorrectAnswer = null;

    const synth = new Tone.Synth().toDestination();
    async function initializeAudioContext() {
      if (Tone.context.state !== 'running') await Tone.start();
    }

    const byId = (id) => document.getElementById(id);
    const btnLearning = byId('btn-learning');
    const btnPractice = byId('btn-practice');
    const pageLearning = byId('page-learning');
    const pagePractice = byId('page-practice');

    function setNavStyles() {
      if (currentPage === 'learning') {
        btnLearning.classList.add('bg-purple-500','text-white','shadow-md');
        btnLearning.classList.remove('bg-purple-200','text-purple-800','hover:bg-purple-300');
        btnPractice.classList.add('bg-green-200','text-green-800','hover:bg-green-300');
        btnPractice.classList.remove('bg-green-500','text-white','shadow-md');
      } else {
        btnPractice.classList.add('bg-green-500','text-white','shadow-md');
        btnPractice.classList.remove('bg-green-200','text-green-800','hover:bg-green-300');
        btnLearning.classList.add('bg-purple-200','text-purple-800','hover:bg-purple-300');
        btnLearning.classList.remove('bg-purple-500','text-white','shadow-md');
      }
    }

    btnLearning.addEventListener('click', async () => {
      await initializeAudioContext();
      currentPage = 'learning';
      pageLearning.classList.remove('hidden');
      pagePractice.classList.add('hidden');
      setNavStyles();
    });

    btnPractice.addEventListener('click', async () => {
      await initializeAudioContext();
      currentPage = 'practice';
      pageLearning.classList.add('hidden');
      pagePractice.classList.remove('hidden');
      setNavStyles();
    });

    // ---- Addition table ----
    function buildAdditionTable(n = 10) {
      const tbl = byId('addition-table');
      tbl.innerHTML = '';

      const thead = document.createElement('thead');
      const trh = document.createElement('tr');

      const th0 = document.createElement('th');
      th0.textContent = '+';
      trh.appendChild(th0);

      for (let c = 1; c <= n; c++) {
        const th = document.createElement('th');
        th.textContent = c;
        th.dataset.col = c;
        trh.appendChild(th);
      }
      thead.appendChild(trh);

      const tbody = document.createElement('tbody');
      for (let r = 1; r <= n; r++) {
        const tr = document.createElement('tr');
        const tdRow = document.createElement('td');
        tdRow.textContent = r;
        tdRow.dataset.rowHeader = r;
        tr.appendChild(tdRow);

        for (let c = 1; c <= n; c++) {
          const td = document.createElement('td');
          td.textContent = r + c;
          td.dataset.row = r;
          td.dataset.col = c;
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      tbl.appendChild(thead);
      tbl.appendChild(tbody);

      // Hover highlightï¼šåˆ—/æ¬„æ·¡é»ƒ + è¡¨é ­/æœ€å·¦æ¬„æ·±é»ƒ
      tbl.addEventListener('mouseover', (e) => {
        const cell = e.target.closest('td');
        if (!cell || !cell.dataset.row) return;
        const r = Number(cell.dataset.row);
        const c = Number(cell.dataset.col);

        // è¡¨é ­èˆ‡æœ€å·¦æ¬„ï¼šæ·±é»ƒ
        tbl.querySelectorAll(`[data-row-header="${r}"]`).forEach(el => el.classList.add('bg-yellow-300'));
        tbl.querySelectorAll(`th[data-col="${c}"]`).forEach(el => el.classList.add('bg-yellow-300'));
        // è©²åˆ—èˆ‡è©²æ¬„ï¼šæ·¡é»ƒ
        tbl.querySelectorAll(`td[data-row="${r}"], td[data-col="${c}"]`).forEach(el => el.classList.add('bg-yellow-100'));
      });

      tbl.addEventListener('mouseout', () => {
        tbl.querySelectorAll('.bg-yellow-100').forEach(el => el.classList.remove('bg-yellow-100'));
        tbl.querySelectorAll('.bg-yellow-300').forEach(el => el.classList.remove('bg-yellow-300'));
      });
    }

    // ---- Practice logic ----
    const practiceSelect = byId('practice-select');
    const practicePlay = byId('practice-play');
    const practiceResult = byId('practice-result');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const btnStart = byId('btn-start');

    modeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        modeButtons.forEach(b => {
          b.classList.remove('bg-indigo-500','text-white','ring-4','ring-indigo-300',
                             'bg-rose-500','ring-rose-300',
                             'bg-amber-500','ring-amber-300',
                             'bg-cyan-500','ring-cyan-300',
                             'bg-teal-500','ring-teal-300');
        });
        selectedMode = btn.dataset.mode;
        if (selectedMode === 'addition18') btn.classList.add('bg-indigo-500','text-white','ring-4','ring-indigo-300');
        if (selectedMode === 'subtraction18') btn.classList.add('bg-rose-500','text-white','ring-4','ring-rose-300');
        if (selectedMode === 'twoDigitAddition') btn.classList.add('bg-amber-500','text-white','ring-4','ring-amber-300');
        if (selectedMode === 'twoDigitSubtraction') btn.classList.add('bg-cyan-500','text-white','ring-4','ring-cyan-300');
        if (selectedMode === 'mixed') btn.classList.add('bg-teal-500','text-white','ring-4','ring-teal-300');

        btnStart.disabled = false;
        btnStart.classList.remove('bg-gray-300','text-gray-600','cursor-not-allowed');
        btnStart.classList.add('bg-blue-500','text-white','hover:bg-blue-600');
      });
    });

    btnStart.addEventListener('click', () => startRound());

    function updatePracticeTitle() {
      const map = {
        addition18: '18ä»¥å…§åŠ æ³•ç·´ç¿’ âœ¨',
        subtraction18: '18ä»¥å…§æ¸›æ³•ç·´ç¿’ âœ¨',
        twoDigitAddition: 'äºŒä½æ•¸åŠ æ³•ç·´ç¿’ âœ¨',
        twoDigitSubtraction: 'äºŒä½æ•¸æ¸›æ³•ç·´ç¿’ âœ¨',
        mixed: 'ç¶œåˆåŠ æ¸›æ³•ç·´ç¿’ âœ¨'
      };
      byId('practice-title').textContent = map[selectedMode] || 'åŠ æ¸›æ³•ç·´ç¿’ âœ¨';
    }

    function delay(ms){ return new Promise(r => setTimeout(r, ms)); }
    async function playCorrect(){
      if (Tone.context.state === 'running'){
        synth.triggerAttackRelease("C5","8n"); await delay(100);
        synth.triggerAttackRelease("G5","8n"); await delay(200);
        synth.triggerAttackRelease("C5","8n"); await delay(100);
        synth.triggerAttackRelease("G5","8n");
      }
    }
    async function playIncorrect(){
      if (Tone.context.state === 'running'){
        synth.triggerAttackRelease("F4","8n"); await delay(250);
        synth.triggerAttackRelease("C4","8n");
      }
    }

    function getRandomInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function makeQuestion(mode){
      let num1, num2, operator, answer;
      if (mode === 'addition18'){ num1=getRandomInt(1,9); num2=getRandomInt(1,9); operator='+'; answer=num1+num2; }
      else if (mode === 'subtraction18'){ num1=getRandomInt(1,18); num2=getRandomInt(1,num1); operator='-'; answer=num1-num2; }
      else if (mode === 'twoDigitAddition'){ num1=getRandomInt(10,99); num2=getRandomInt(10,99); operator='+'; answer=num1+num2; }
      else if (mode === 'twoDigitSubtraction'){ num1=getRandomInt(10,99); num2=getRandomInt(10,num1); operator='-'; answer=num1-num2; }
      else { const modes=['addition18','subtraction18','twoDigitAddition','twoDigitSubtraction']; return makeQuestion(modes[Math.floor(Math.random()*modes.length)]); }

      const set = new Set([answer]);
      if (mode === 'twoDigitAddition' || mode === 'twoDigitSubtraction'){
        const potentials=[answer+10, answer-10]; const unit = answer%10; let added=false;
        for (const w of potentials){ if (w>=0 && w<=199 && w!==answer && w%10===unit && !set.has(w)){ set.add(w); added=true; break; } }
        if (!added){
          for (let i=0;i<5;i++){ let off=(getRandomInt(1,3)*10)*(Math.random()<0.5?1:-1);
            const w=answer+off; if (w>=0 && w<=199 && w!==answer && w%10===unit && !set.has(w)){ set.add(w); break; } }
        }
      }
      while (set.size<4){
        let range=5; if (answer>50) range=15; else if (answer<10) range=3;
        let off=getRandomInt(-range,range); if (off===0) off=(Math.random()<0.5?1:-1)*getRandomInt(1,2);
        const w=answer+off; if (w>=0 && w!==answer && !set.has(w)) set.add(w);
      }
      const opts = Array.from(set).sort(()=>Math.random()-0.5);
      return { num1,num2,operator,answer,options:opts };
    }

    function renderQuestion(){
      byId('score').textContent = String(score);
      byId('q-index').textContent = String(qIndex+1);
      const qBox = byId('question-box'); const optsBox = byId('options');
      const feedback = byId('feedback'); qBox.innerHTML='';

      if (selectedMode==='twoDigitAddition' || selectedMode==='twoDigitSubtraction'){
        const wrap=document.createElement('div');
        wrap.className='flex flex-col items-end text-yellow-800 font-extrabold text-5xl md:text-6xl mx-auto relative min-w-[150px]';
        const top=document.createElement('div'); top.className='w-full text-right'; top.textContent=currentQuestion.num1;
        const mid=document.createElement('div'); mid.className='flex items-baseline w-full justify-end relative';
        const op=document.createElement('span'); op.className='absolute left-0 text-4xl md:text-5xl -mt-1'; op.textContent=currentQuestion.operator;
        const bottom=document.createElement('span'); bottom.className='flex-grow text-right'; bottom.textContent=currentQuestion.num2;
        const line=document.createElement('div'); line.className='w-full border-t-4 border-yellow-800 mt-2 pt-2 text-right'; line.textContent='?';
        mid.appendChild(op); mid.appendChild(bottom); wrap.appendChild(top); wrap.appendChild(mid); wrap.appendChild(line); qBox.appendChild(wrap);
      }else{
        const p=document.createElement('p'); p.className='text-5xl md:text-6xl font-extrabold text-yellow-800';
        p.textContent=`${currentQuestion.num1} ${currentQuestion.operator} ${currentQuestion.num2} = ?`; qBox.appendChild(p);
      }

      optsBox.innerHTML=''; currentQuestion.options.forEach(opt=>{
        const btn=document.createElement('button');
        btn.className='opt-btn p-4 rounded-2xl text-3xl font-bold transition-all duration-300 transform hover:scale-105 shadow-md bg-indigo-300 text-indigo-900 hover:bg-indigo-400';
        btn.textContent=opt; btn.dataset.value=opt; btn.disabled=false; optsBox.appendChild(btn);
      });

      feedback.textContent=''; feedback.className='text-2xl md:text-3xl font-bold mt-4';
    }

    function generateQuestion(){
      const q = makeQuestion(selectedMode);
      currentQuestion = { num1:q.num1, num2:q.num2, operator:q.operator, answer:q.answer };
      options = q.options.slice(); currentQuestion.options = options;
      selectedAnswer = null; isCorrectAnswer = null; renderQuestion();
    }

    // æ­£ç¢ºäº®ç¶ ã€éŒ¯èª¤äº®ç´…ï¼Œå…¶ä»–è®Šæ·¡
    byId('options').addEventListener('click', async (e)=>{
      const btn = e.target.closest('.opt-btn'); if(!btn) return;
      if (selectedAnswer !== null) return;

      selectedAnswer = Number(btn.dataset.value);
      const correct = selectedAnswer === currentQuestion.answer;
      isCorrectAnswer = correct;

      document.querySelectorAll('.opt-btn').forEach(b=>{
        const val = Number(b.dataset.value);
        b.disabled = true;
        b.classList.remove('bg-indigo-300','text-indigo-900','hover:bg-indigo-400','bg-green-500','bg-red-500','opacity-50','cursor-not-allowed','scale-110','scale-105','shadow-lg');
        if (val === currentQuestion.answer){
          b.classList.add('bg-green-500','text-white','scale-110','shadow-lg');
        }else if (val === selectedAnswer && !correct){
          b.classList.add('bg-red-500','text-white','scale-105','shadow-lg');
        }else{
          b.classList.add('bg-indigo-300','text-indigo-900','opacity-50','cursor-not-allowed');
        }
      });

      const fb = byId('feedback');
      if (correct){ score += 10; fb.textContent='âœ… ç­”å°äº†ï¼'; await playCorrect(); }
      else { fb.textContent=`âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${currentQuestion.answer}`; await playIncorrect(); }

      questionHistory.push({ question:`${currentQuestion.num1} ${currentQuestion.operator} ${currentQuestion.num2}`, correctAnswer:currentQuestion.answer, userAnswer:selectedAnswer, isCorrect:correct });

      setTimeout(()=>{ if (qIndex<9){ qIndex+=1; generateQuestion(); } else { showResult(); } }, 1500);
    });

    function startRound(){
      score=0; qIndex=0; questionHistory=[]; selectedAnswer=null; isCorrectAnswer=null;
      practiceSelect.classList.add('hidden'); practiceResult.classList.add('hidden'); practicePlay.classList.remove('hidden');
      updatePracticeTitle(); generateQuestion();
    }

    function showResult(){
      practicePlay.classList.add('hidden'); practiceResult.classList.remove('hidden');
      byId('final-score').textContent = `${score} åˆ†`;
      const rb = byId('review-body'); rb.innerHTML='';
      questionHistory.forEach(item=>{
        const tr=document.createElement('tr');
        tr.className='border-b border-blue-50 last:border-b-0 hover:bg-blue-50 transition-colors duration-200';
        tr.innerHTML = `
          <td class="py-2 px-3 font-bold">${item.question}</td>
          <td class="py-2 px-3 font-semibold ${item.isCorrect?'text-green-600':'text-red-500'}">${item.userAnswer}</td>
          <td class="py-2 px-3 font-bold text-gray-700">${item.correctAnswer}</td>`;
        rb.appendChild(tr);
      });
      const map={ addition18:'å†ç©ä¸€æ¬¡18ä»¥å…§åŠ æ³•ï¼âœ¨', subtraction18:'å†ç©ä¸€æ¬¡18ä»¥å…§æ¸›æ³•ï¼âœ¨', twoDigitAddition:'å†ç©ä¸€æ¬¡äºŒä½æ•¸åŠ æ³•ï¼ğŸ”¢', twoDigitSubtraction:'å†ç©ä¸€æ¬¡äºŒä½æ•¸æ¸›æ³•ï¼ğŸ“Š', mixed:'å†ç©ä¸€æ¬¡ç¶œåˆç·´ç¿’ï¼ğŸ²' };
      byId('btn-retry').textContent = map[selectedMode] || 'å†ç©ä¸€æ¬¡ï¼âœ¨';
    }

    byId('btn-reselect').addEventListener('click', ()=>{
      selectedMode=null;
      btnStart.disabled=true;
      btnStart.classList.add('bg-gray-300','text-gray-600','cursor-not-allowed');
      btnStart.classList.remove('bg-blue-500','text-white','hover:bg-blue-600');
      document.querySelectorAll('.mode-btn').forEach(b=>{
        b.classList.remove('bg-indigo-500','text-white','ring-4','ring-indigo-300','bg-rose-500','ring-rose-300','bg-amber-500','ring-amber-300','bg-cyan-500','ring-cyan-300','bg-teal-500','ring-teal-300');
      });
      practicePlay.classList.add('hidden'); practiceResult.classList.add('hidden'); practiceSelect.classList.remove('hidden');
    });
    byId('btn-retry').addEventListener('click', ()=> startRound());

    // Init
    buildAdditionTable(10);
    setNavStyles();
  </script>
</body>
</html>


